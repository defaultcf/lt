---
name: Secure Linux
layout: slide-remark
---

count: false
class: center, middle

# Linuxをセキュアに扱う


---

## 発表者

Isaac

{% include self-introduction.md %}


---

## Linuxのセキュリティ、考えてる？

1. SELinux有効化して、ガチガチにやってる！
2. ファイアウォール厳密にしてるし、大丈夫っしょ
3. Linux向けのウィルス無いって言うし、特に何もしなくていいっしょ


---

## 個人的な感想

1. SELinux有効化して、ガチガチにやってる！
  - おそらく玄人。私が言うことは何も無い。

2. ファイアウォール厳密にしてるし、大丈夫っしょ
  - もうちょっと防御策検討しても良いかも？

3. Linux向けのウィルス無いって言うし、特に何もしなくていいっしょ
  - ウィルスはあります。Botがインターネットを走り回って、穴を探しています。インターネットに繋がっているなら一刻も早く対策を採りましょう。


---

## かつて私は何も対策しなかった

先代から受け継いだサーバを、セキュリティ設定を疑わず、そのまま運用していた。

そうすると、ネットワーク管理者から「おたくのサーバから外部のサーバに不正なアクセスがされてるんだが」って連絡が来る。

クリーンインストールして、厳密にセキュリティの設定して、再稼働の許可を得た。


---

## どんな風に侵入されるの？

- 認証がザル
  - SSHでパスワード認証を許可している
  - パスワードが脆弱
- ファイアウォールがきちんと設定されていない
  - ミドルウェア側の認証もザル
- 他、ソフトウェアに作ってしまった脆弱性によって
  - SQLインジェクション
  - コマンドインジェクション
  - ディレクトリトラバーサル
  - [他にもいっぱい！](https://ja.wikipedia.org/wiki/Template:%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%97%E3%83%AD%E3%82%A4%E3%83%88)
- インターネットからよく分からないファイルを落としてきて実行するユーザの存在

色んな脆弱性を組み合わせて侵入される。


---

## 最初の対策

まずは認証を正す。不正なユーザが認証を通ってやりたい放題できないように、SSHは公開鍵認証のみにし、各種ミドルウェアのパスワードは強固なものにする。

また、ファイアウォールを見直す。必要最低限のポートのみ開ける。

これだけでBotによる攻撃の多くを防げる。


---

## ソフトウェアにある脆弱性はどうする？

SELinuxなどの強制アクセス制御（MAC）を有効化することで、これまた攻撃の多くを防げる。

例えば、ディレクトリトラバーサルを考える。ウェブサービス側が作った脆弱性だが、つまるところ『**Apacheなどのウェブサーバが不正なファイルにアクセスする**』ことで発生する。SELinuxはこのアクセスを防ぐことができる。

コマンドインジェクションを考える。Apacheが不正なプロセスを立ち上げることで発生する。SELinuxはこのプロセス立ち上げを防ぐことができる。


---

## ユーザの愚かな行いはどう防ぐ？

例) ソフトウェアをインストールするために、ミラーサイトからバイナリを落としてきた。ハッシュとか署名とかよく分からないので、特に検証することなくそのまま実行した。

↓

実はミラーサーバが攻撃者に侵入されていて、バイナリが不正なものに置き換わっていた。それを知らずにバイナリを実行してしまったため、更に自分のサーバも攻撃者の思うままにされた。

一般ユーザで実行したならまだ良いが（よくない）、sudo付けて実行した時は大変深刻。SELinuxならroot権限さえも制限することができるので、被害を小さめに抑えることができる。

**...正直、sudo使えるユーザはちゃんと出来るユーザでないと困るんだけどね**


---

## "防ぐことができる"？

これまたきちんと設定しないと、正しく効果を発揮しない。特にSELinuxは設定が複雑...

MACの仕組みは他にもあって、Tomoyo LinuxやAppArmorには学習モードがあるのでもうちょっと楽に設定が行える。
